{% extends 'mailing_list/base.html' %}

{% load static %}

{% block js %}
<script type="text/javascript">
$(document).ready(function(){
  //tooltip for buttons (done this way because of dynamically created icons)
  $('body').tooltip({
    selector: '[rel=tooltip]'
  });
  $('[rel=tooltip]').tooltip({
    container: 'body'
  });
});
</script>
{% endblock js %}

{% block body %}
<body class="lti-tool"
    role="application"
    ng-controller="MailingListController as ml">

<div class="container">
  <header>
    <div class="row lti-header">
      <h1>
        {% block breadcrumbs %}Course Emailer{% endblock breadcrumbs %}
      </h1>
    </div>
  </header>

  <div class="loading-indicator" ng-show="ml.isLoading">
    <img src="{% static 'images/ajax-loader-large.gif' %}"/>
  </div>

  <main>

    <div class="col-md-12">
          <h2>Mailing Lists for {{course_name}}</h2>
            <p class="caption">
                This tool provides mailing lists to contact members of your course using an email
              client (e.g. Outlook, Gmail, etc.). Be sure to use the email address that is set as
              your default in Canvas.
                <a target="_blank"
                   href="https://wiki.harvard.edu/confluence/display/canvas/Course+Emailer "
                   class="lti-tooltip"
                   rel="tooltip"
                   data-toggle="tooltip"
                   title=""
                   data-original-title="More info about the Course Emailer">
                    <i class="fa fa-question-circle"></i>
                </a>
            </p>
            <p>
                <div ng-show="ml.hasCourseEmailList()">
                    This course site includes enrollment from two or more courses.
                    <a target="_blank"
                       href="https://wiki.harvard.edu/confluence/pages/viewpage.action?pageId=189597345"
                       class="lti-tooltip"
                       rel="tooltip"
                       data-toggle="tooltip"
                       title=""
                       data-original-title="More info about cross listed courses">
                        <i class="fa fa-question-circle"></i>
                  </a>
              </div>
          </p>
          <p class="caption">
            If you would like a copy of your email, add your own email address to the CC or BCC field.
          </p>
        </div>

    <div class="col-md-12">

      <!-- show combined mailing list or single primary list -->
      <!-- if there is a combined mailing list show it -->
      <h2>Email Entire Course</h2>

      <div ng-repeat="list in ml.courseList">
        {% include "mailing_list/_mailing_list_details.html" with scope="class" %}
        <div class="col-md-12">
          <hr width="98%">
        </div>
      </div>

      <div ng-if="list.is_primary && !ml.hasCourseEmailList(list)" ng-repeat="list in ml.enrollmentSectionLists">
        {% include "mailing_list/_mailing_list_details.html" with scope="class" %}
        <div class="col-md-12">
          <hr width="98%">
        </div>
      </div>

      <div class="btn-group col-md-12">
        <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
          <div class="panel panel-default" ng-show="ml.hasNonEnrollmentSections()">
            <div class="panel-heading" role="tab" id="headingOne">
              <h4 class="panel-title">
                <a class="collapsed"
                 role="button"
                 data-toggle="collapse"
                 data-parent="#accordion"
                 href="#collapseTwo"
                 aria-expanded="false" aria-controls="collapseTwo">
                  <ng-pluralize count="ml.nonEnrollmentSectionLists.length"
                        when="{'0': 'No Sections', '1': 'Email Specific Section', 'other': 'Email Specific Sections'}">
                  </ng-pluralize>
                </a>
              </h4>
            </div>

            <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
              <div class="panel-body">
                <div class="col-md-12">
                  <p class="caption">
                    If you would like a copy of your email, add your own email address to the CC or BCC field.
                    Any email sent to a section will be delivered to all staff in the course, even if they have not
                    been added to the section.
                  </p>
                  <p class="caption">
                    These sections are created in the Manage Sections tool (if installed in your account) or are
                    being sent from SIS.
                  </p>
                  <p class="caption">
                    Any changes made to those sections will be reflected within these lists.
                  </p>
                </div>
                <div class="content-section" ng-repeat="list in ml.nonEnrollmentSectionLists">
                  {% include "mailing_list/_mailing_list_details.html" with scope="section" %}
                </div>
              </div>
            </div>
          </div>
          <br />
          <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
            <div class="panel panel-default" ng-show="ml.hasMultipleEnrollmentSections()">
              <div class="panel-heading" role="tab" id="headingOne">
                <h4 class="panel-title">
                  <a class="collapsed"
                   role="button"
                   data-toggle="collapse"
                   data-parent="#accordion"
                   href="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                    Email Register Enrollment Sections
                  </a>
                </h4>
              </div>

              <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="panel-body">
                  <div class="col-md-12">
                    <p class="caption">
                      If you would like a copy of your email, add your own email address to the CC or BCC field.
                      Any email sent to a section will be delivered to all staff in the course, even if they have not
                      been added to the section.
                    </p>
                    <p class="caption">
                      These mailing lists contains staff, students, and guests from individual schools.
                    </p>
                  </div>
                  <div  ng-repeat="list in ml.enrollmentSectionLists">
                    {% include "mailing_list/_mailing_list_details.html" with scope="class" %}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>

</body>
{% endblock body %}

