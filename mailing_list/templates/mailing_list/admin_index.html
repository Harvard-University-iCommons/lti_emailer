{% extends 'mailing_list/base.html' %}

{% load static %}

{% block js %}
<script type="text/javascript">
$(document).ready(function(){
  //tooltip for buttons (done this way because of dynamically created icons)
  $('body').tooltip({
    selector: '[rel=tooltip]'
  });
  $('[rel=tooltip]').tooltip({
    container: 'body'
  });
});
</script>
{% endblock js %}

{% block body %}
<body class="lti-tool"
    role="application"
    ng-controller="MailingListController as ml">

<div class="container">
  <header>
    <div class="row lti-header">
      <h1>
        {% block breadcrumbs %}Course Emailer{% endblock breadcrumbs %}
      </h1>
    </div>
  </header>
  <div class="loading-indicator" ng-show="ml.isLoading">
    <img src="{% static 'images/ajax-loader-large.gif' %}"/>
  </div>
  <main>
    <div class="row">
      <div id="course-mailing-lists" class="col-md-12">
        <h2>Mailing Lists for {{course_name}}</h2>
          <p class="caption">
            This tool provides mailing lists that allow you to contact members
            of your course using an email client (e.g. Outlook, Gmail, etc.)
            as an alternative to the Canvas Inbox. You <b>must</b> send your
            message from the email address that is set as your default in
            Canvas or your message will not be delivered.
              <a target="_blank"
                 href="https://wiki.harvard.edu/confluence/display/canvas/Course+Emailer "
                 class="lti-tooltip"
                 rel="tooltip"
                 data-toggle="tooltip"
                 title=""
                 data-original-title="More info about the Course Emailer">
                  <i class="fa fa-question-circle"></i>
              </a>
          </p>
      </div>
    </div>

    <div class="row">
      <!-- main list of meta list-->
      <div class="col-md-12">

        <!-- show combined mailing list or single primary list -->
        <!-- if there is a combined mailing list show it -->
        <h2 ng-show="ml.hasCourseEmailList()">Email Entire Course</h2>
        <p class=""caption ng-show="ml.hasCourseEmailList()">
          Email all students, teaching staff, and guests enrolled in this course.
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-md-12">
        <div ng-repeat="list in ml.courseList">
          {% include "mailing_list/_mailing_list_details.html" with scope="class" %}
        </div>
        <div class="row">
          <div class="col-md-12">
            <hr>
          </div>
        </div>
      </div>
    </div>

    <div class="row" ng-show="ml.courseSettings.formValues">
      <div class="col-md-12">
        <h2>Global Mailing List Settings</h2>
      </div>
      <div class="col-md-12">
        <div class="radio">
          <label>
            <input type="radio"
                   ng-change="ml.updateCourseSettings()"
                   ng-disabled="ml.courseSettings.isUpdating"
                   ng-model="ml.courseSettings.formValues.alwaysMailStaff"
                   ng-value="true"
                   name="non-enrollment-section-lists-always-mail-staff">
            Any email sent to a section will be delivered to members
            of that section <strong>and to all staff in the
            course</strong>.
          </label>
        </div>
        <div class="radio">
          <label>
            <input type="radio"
                   ng-change="ml.updateCourseSettings()"
                   ng-disabled="ml.courseSettings.isUpdating"
                   ng-model="ml.courseSettings.formValues.alwaysMailStaff"
                   ng-value="false"
                   name="non-enrollment-section-lists-always-mail-staff">
            Email sent to a section will be delivered
            <strong>only to members of that section</strong>.
          </label>
        </div>
        <p>
          With either of the above options, the sender will always
          receive a copy of the email sent to either the entire
          course or a section.
        </p>
      </div>
    </div>

    <div class="row" ng-show="ml.courseSettings.isUpdating">
      <div class="col-md-12">
        <div class="loading-indicator text-center">
          <img src="{% static 'images/ajax-loader-large.gif' %}"/>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-md-12" ng-show="ml.courseSettings.alert && !ml.courseSettings.isUpdating">
        <div class="alert alert-no-margin"
             ng-class="ml.courseSettings.alert.type"
             ng-bind-html="ml.courseSettings.alert.message"
             role="alert">
        </div>
      </div>
    </div>

    <div class="row" ng-show="ml.courseSettings.formValues">
      <div class="col-md-12">
        <hr>
      </div>
    </div>

    <div class="row">
      <div class="btn-group col-md-12">
        <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
          <div class="panel panel-default" ng-show="ml.hasNonEnrollmentSections()">
            <div class="panel-heading" role="tab" id="headingOne">
              <h4 class="panel-title">
                <a class="collapsed"
                 role="button"
                 data-toggle="collapse"
                 data-parent="#accordion"
                 href="#collapseTwo"
                 aria-expanded="false" aria-controls="collapseTwo">
                  <ng-pluralize count="ml.nonEnrollmentSectionLists.length"
                        when="{'0': 'No Sections', '1': 'Email Specific Section', 'other': 'Email Specific Sections'}">
                  </ng-pluralize>
                </a>
              </h4>
            </div>
            <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
              <div class="panel-body">
                <div class="col-md-12">

                  <div>
                  These sections are created in one of two ways:<br />
                    <ul style="list-style-type: none;">
                    <li> <span class="label label-primary">&nbsp;&nbsp;</span> - using the Manage Sections tool (if installed in your course)</li>
                    <li><span class="label label-success">&nbsp;&nbsp;</span> - using your student information system (e.g. my.harvard)</li>
                  </ul>
                  Any changes you make to those sections will be reflected within these lists.
                  </div>

                  <p class="caption">
                    Any email sent to a section will be delivered to members of that section <b>and to all staff in the course.</b>
                  </p>
                </div>
                <div class="content-section" ng-repeat="list in ml.nonEnrollmentSectionLists">
                  {% include "mailing_list/_mailing_list_details.html" with scope="section" %}
                </div>
              </div>
            </div>
            </div>
          <br />
          <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
            <div class="panel panel-default" ng-show="ml.hasMultipleEnrollmentSections()">
              <div class="panel-heading" role="tab" id="headingOne">
                <h4 class="panel-title">
                  <a class="collapsed"
                   role="button"
                   data-toggle="collapse"
                   data-parent="#accordion"
                   href="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                    <ng-pluralize count="ml.enrollmentSectionLists.length"
                        when="{'0': 'No Sections', '1': 'Email Registrar Enrollment', 'other': 'Email Registrar Enrollments'}">
                  </ng-pluralize>
                  </a>
                </h4>
              </div>

              <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="panel-body">
                  <div class="col-md-12">
                    <p class="caption" ng-show="ml.hasCourseEmailList()">
                      This course site includes enrollment from two or more courses.
                      <a target="_blank"
                       href="https://wiki.harvard.edu/confluence/pages/viewpage.action?pageId=189597345"
                       class="lti-tooltip"
                       rel="tooltip"
                       data-toggle="tooltip"
                       title=""
                       data-original-title="More info about cross listed courses">
                        <i class="fa fa-question-circle"></i>
                      </a>
                    </p>
                    <p class="caption">
                      The lists below reflect enrollments from the Registrarâ€™s office and will be updated automatically.
                      Any email sent to a list will be delivered to members of that list <b>and to all staff in the course.</b>
                    </p>
                  </div>
                  <div  ng-repeat="list in ml.enrollmentSectionLists">
                    {% include "mailing_list/_mailing_list_details.html" with scope="class" %}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>

</body>
{% endblock body %}

